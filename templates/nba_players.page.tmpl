{{template "base" .}}

{{define "content"}}

<div class="container">
    <h3>Players</h3>
    <div class="row">
        <div id="players_table" class="col-md-9">
            <table class="table table-sm table-responsive table-borderless" style="border-bottom: 0.5px solid rgb(190, 190, 190);">
                <thead style="font-size: 14px; white-space: nowrap; text-align: center;">
                    <tr style="background-color: white; border-bottom: 1px solid rgb(190, 190, 190);">
                        <th>#</th>
                        <th></th>
                        <th class="ps-2" style="text-align: start;">NAME</th>
                        <th>TEAM</th>
                        <th title="Overall Rating" data-bs-toggle="tooltip" data-bs-placement="bottom">OVR</th>
                        <th title="Three Point Shot" data-bs-toggle="tooltip" data-bs-placement="bottom">3PT</th>
                        <th title="Driving Dunk" data-bs-toggle="tooltip" data-bs-placement="bottom">DUNK</th>
                        <th title="Athleticism" data-bs-toggle="tooltip" data-bs-placement="bottom">ATHL</th>
                        <th title="Interior Defense" data-bs-toggle="tooltip" data-bs-placement="bottom">INT D</th>
                        <th title="Perimeter Defense" data-bs-toggle="tooltip" data-bs-placement="bottom">PER D</th>
                        <th title="Rebounding" data-bs-toggle="tooltip" data-bs-placement="bottom">REB</th>
                        <th>BADGES</th>
                        <th title="Total Attributes" data-bs-toggle="tooltip" data-bs-placement="bottom">TOTAL</th>
                    </tr>
                </thead>
                <tbody style="white-space: nowrap; text-align: center; vertical-align: middle;">

                    {{$ranking := index .Data "ranking"}}
                    {{range $index, $players := index .Data "nba_players"}}
                    <tr class="searchable" style="border-top: 0.5px solid rgb(190, 190, 190);">
                        <td class="p-0">{{index $ranking $index}}</td>
                        <td class="p-0 py-1">
                            <div id="playerimg_{{$index}}">
                                <div id="playerimgreload_{{$index}}">
                                {{if $players.TeamID.Int64}}
                                        {{range $teamInfo := index $.Data "nba_teams"}}
                                            {{if eq $teamInfo.TeamID $players.TeamID}}
                                                <img src="{{if ne $players.ImgUrl ""}}{{$players.ImgUrl}}{{else}}/static/images/lightProfile.png{{end}}"
                                                alt="" class="header-image rounded-circle inline-block" style="border-style: none; background-image: linear-gradient(90deg, {{$teamInfo.Color1}}, {{$teamInfo.Color2}});">
                                            {{end}}
                                        {{end}}
                                        {{else}}
                                            <img src="{{if ne $players.ImgUrl ""}}{{$players.ImgUrl}}{{else}}/static/images/lightProfile.png{{end}}"
                                            alt="" class="header-image rounded-circle bg-light border">
                                        {{end}}
                                </div>
                            </div>
                    </td>
                        <td class="p-0 ps-2">
                            <div class="d-flex player-card">
                                <div class="p-0 inline-block">
                                    <p class="m-0"><a class="player-link" href="/nba/players/{{$players.PlayerID}}">{{$players.FirstName}} {{$players.LastName}}</a></p>
                                    <div class="my-0">
                                        <p class="text-muted my-0" style="font-size: 12px;">
                                            {{$players.PrimaryPosition}}{{if $players.SecondaryPosition}}/{{end}}{{$players.SecondaryPosition}}
                                            | {{$players.Height}}cm | {{$players.Weight}}kg
                                        </p>
                                    </div>

                                </div>
                            </div>
                        </td>

                        
                        <td class="p-0">
                            <div id="player_{{$index}}">
                                <div id="player_reload_{{$index}}">
                                    {{if $players.TeamID.Int64}}
                                    {{range $teamInfo := index $.Data "nba_teams"}}
                                        {{if eq $teamInfo.TeamID $players.TeamID}}
                                        <span style="background-image: linear-gradient(90deg, {{$teamInfo.Color1}}, {{$teamInfo.Color2}}); display:inline-block; width:60px" 
                                        class="playerbadge badge badge-pill p-1 fw-semibold pointer {{if eq $teamInfo.DarkText "true"}}text-dark{{end}}" data-bs-toggle="dropdown" aria-expanded="false">{{$teamInfo.Abbreviation}}</span>
                                        {{end}}
                                    {{end}}
                                    {{else}}
                                        <span style="width:60px;" class="playerbadge badge badge-pill p-1 bg-light text-dark fw-semibold border pointer" 
                                        data-bs-toggle="dropdown" aria-expanded="false">FA</span>
                                    {{end}}

                                    <div class="dropdown-menu">
                                        {{range $teams := index $.Data "nba_teams"}}
                                            <li class="dropdown-item" onclick="updateTeam('{{$index}}', '{{$players.PlayerID}}', '{{$teams.TeamID.Int64}}')">
                                                {{$teams.Abbreviation}} {{$teams.Name}}
                                            </li>
                                        {{end}}
                                        <hr class="dropdown-divider">
                                        <li class="dropdown-item" onclick="updateTeam('{{$index}}', '{{$players.PlayerID}}', 'null')">
                                            Free Agency
                                        </li>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span style="font-size: 16px;" class="
                            {{if ge $players.StatsOverall 81}}
                                {{if ge $players.StatsOverall 86}}
                                    {{if ge $players.StatsOverall 91}}
                                        overall1
                                    {{else}}
                                        overall2
                                    {{end}}
                                {{else}}
                                    overall3
                                {{end}}
                            {{else}}
                                overall4
                            {{end}}
                        ">{{.StatsOverall}}</span></td>
                        <td>{{$players.StatsThreePointShot}}</td>
                        <td>{{$players.StatsDrivingDunk}}</td>
                        <td>{{$players.StatsAthleticism}}</td>
                        <td>{{$players.StatsInteriorDefense}}</td>
                        <td>{{$players.StatsPerimeterDefense}}</td>
                        <td>{{$players.StatsRebounding}}</td>
                        <td>
                            <span class="playerbadge badge badge-pill p-1 bronze">{{$players.BronzeBadgesCount}}</span>
                            <span class="playerbadge badge badge-pill p-1 silver">{{$players.SilverBadgesCount}}</span>
                            <span class="playerbadge badge badge-pill p-1 gold">{{$players.GoldBadgesCount}}</span>
                            <span class="playerbadge badge badge-pill p-1 hof">{{$players.HOFBadgesCount}}</span>
                            <span class="playerbadge badge badge-pill p-1 total">{{$players.TotalBadgesCount}}</span>
                        </td>
                        <td>
                            <span class="playerbadge badge badge-pill p-1 text-dark" style="background-color: rgb(237, 237, 237); width: 50px;">{{$players.StatsTotalAttributes}}</span>
                        </td>
                    </tr>
                    {{end}}

                </tbody>
            </table>
            <div class="row">
                <nav aria-label="Page navigation example">
                    <ul class="pagination justify-content-center">
                        {{ if (gt .Data.pagination.CurrentPage 1)}}
                        <li class="page-item"><a class="page-link" href="/nba/players/page={{.Data.pagination.PreviousPage}}">Previous</a></li>
                        {{end}}

                        {{ if (gt .Data.pagination.CurrentPage 1)}}
                        <li class="page-item"><a class="page-link" href="/nba/players/page={{.Data.pagination.PreviousPage}}">{{.Data.pagination.PreviousPage}}</a></li>
                        {{end}}

                        <li class="page-item"><a class="page-link active" href="#">{{.Data.pagination.CurrentPage}}</a></li>

                        {{ if (lt .Data.pagination.CurrentPage .Data.pagination.TotalPages)}}
                        <li class="page-item"><a class="page-link" href="/nba/players/page={{.Data.pagination.NextPage}}">{{.Data.pagination.NextPage}}</a></li>
                        {{end}}

                        {{ if (lt .Data.pagination.CurrentPage .Data.pagination.TotalPages)}}
                        <li class="page-item"><a class="page-link" href="/nba/players/page={{.Data.pagination.NextPage}}">Next</a></li>
                        {{end}}
                    </ul>
                </nav>
            </div>
        </div>
        
        <div class="col-md-3">
            <div class="row">
                <p class="fw-bold mt-1" style="font-size: 14px;">SEARCH</p>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <p style="font-size: 16px;">Three Point Shot</p>
                </div>
                <div class="col-md-3">
                    <input id="away_score" type="text" class="form-control" value=0>
                </div>
                <div class="col-md-3">
                    <input id="away_score" type="text" class="form-control" value=99>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <p style="font-size: 16px;">Three Point Shot</p>
                </div>
                <div class="col-md-3">
                    <input id="away_score" type="text" class="form-control" value=0>
                </div>
                <div class="col-md-3">
                    <input id="away_score" type="text" class="form-control" value=99>
                </div>
            </div>
            <div class="row">
                <div class="col-md-6">
                    <p style="font-size: 16px;">Three Point Shot</p>
                </div>
                <div class="col-md-3">
                    <input id="away_score" type="text" class="form-control" value=0>
                </div>
                <div class="col-md-3">
                    <input id="away_score" type="text" class="form-control" value=99>
                </div>
            </div>
        </div>
    </div>
</div>



{{end}}

{{define "js"}}
<script>
   function updateTeam(index, playerID, teamID) {
        console.log(index)
        console.log(playerID)
        console.log(teamID)
        $.ajax({
            type: 'GET',
            dataType: 'html',
            data : {
                action: "update",
                player_id: playerID,
                team_id: teamID,
            },
            success: function(data) {
                console.log("success");
                $( '#playerimg_' + index).load(window.location.href + ' #playerimgreload_' + index );
                $( '#player_' + index).load(window.location.href + ' #player_reload_' + index );
            }
        });
    }
</script>

{{end}}