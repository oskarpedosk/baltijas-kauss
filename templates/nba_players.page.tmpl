{{template "base" .}}

{{define "content"}}

<div class="container">
    <div class="row">
        <div class="col">
            <h1 class="mt-5">2K23</h1>

            <input class="form-control" id="myInput" type="text" placeholder="Search..">
            <br>
            <table class="table table-sm table-responsive">
                <thead style="font-size: 8px; white-space: nowrap; text-align: center;">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col" style="text-align: start;">Player</th>
                        <th scope="col">Team</th>
                        <th scope="col">Badges</th>
                        <th scope="col">Overall</th>
                        <th scope="col">DEF</th>
                        <th scope="col">3PT</th>
                        <th scope="col">FT</th>
                        <th scope="col">Speed</th>
                        <th scope="col">Acceleration</th>
                        <th scope="col">Strength</th>
                        <th scope="col">Vertical</th>
                        <th scope="col">Driving Dunk</th>
                        <th scope="col">Draw Foul</th>
                        <th scope="col">INT D</th>
                        <th scope="col">PER D</th>
                        <th scope="col">STL</th>
                        <th scope="col">BLK</th>
                        <th scope="col">OREB</th>
                        <th scope="col">DREB</th>
                        <th scope="col">Total Attributes</th>
                    </tr>
                </thead>
                <tbody id="nbaPlayersTable" style="white-space: nowrap; text-align: center; vertical-align: middle;">

                    {{range $index, $players := index .Data "nba_players"}}
                    <tr>
                        <td>{{add $index 1}}</td>
                        <td>
                            <div class="d-flex player-card">
                                <img src="{{$players.ImgUrl}}"
                                    alt="" class="header-image rounded-circle inline-block mt-1">
                                <div class="ms-2 p-0 inline-block">
                                    <p class="my-0">{{$players.FirstName}} {{$players.LastName}}</p>
                                    <p class="text-muted my-0" style="font-size: 10px;">{{$players.Archetype}}</p>
                                    <div class="team-pill-row my-0">
                                        <p class="text-muted my-0" style="font-size: 10px;">
                                            {{$players.PrimaryPosition}}
                                            {{$players.SecondaryPosition}}
                                            | {{$players.Height}}cm | {{$players.Weight}}kg
                                            </p>
                                        </p>
                                    </div>

                                </div>
                            </div>
                        </td>
                        <td>
                            {{if $players.TeamID.Int64}}
                            {{range $teamInfo := index $.Data "nba_teams"}}
                                {{if eq $teamInfo.TeamID $players.TeamID}}
                                    <p class="badge badgehover badge-pill my-0 ms-1 {{if eq $teamInfo.DarkText "true"}}text-dark{{end}}" class="dropdown-toggle"
                                    data-bs-toggle="dropdown" aria-expanded="false" style="background-image: linear-gradient(90deg, {{$teamInfo.Color1}}, {{$teamInfo.Color2}}); display:inline-block; width:70px">
                                    {{$teamInfo.Abbreviation}}
                                    </p>
                                {{end}}
                            {{end}}
                        {{else}}
                        <p style="display:inline-block; width:70px" class="badge badgehover badge-pill border bg-light text-dark my-0 ms-1" class="dropdown-toggle"
                        data-bs-toggle="dropdown" aria-expanded="false">
                            FA
                        </p>
                        {{end}}

                            <form id="teamSelect_{{$index}}" action="/nba/players" method="post">
                                <input type="hidden" name="csrf_token" value="{{$.CSRFToken}}">
                                <input type="hidden" name="index" value="{{$index}}">
                                <input type="hidden" name="player_id" value="{{$players.PlayerID}}">
                                <div class="dropdown-menu">
                                    {{range $teams := index $.Data "nba_teams"}}
                                    <input type="hidden" id="field_{{$index}}" name="team_id" value="">
                                        <li class="dropdown-item" onclick="submitForm('{{$teams.TeamID.Int64}}', 'field_{{$index}}', 'teamSelect_{{$index}}')">
                                            {{$teams.Abbreviation}} {{$teams.Name}}
                                        </li>
                                    {{end}}
                                    <hr class="dropdown-divider">
                                    <li class="dropdown-item" onclick="submitForm('null', 'field_{{$index}}', 'teamSelect_{{$index}}')"><input type="hidden" name="team_id" value="">
                                        Free Agency
                                    </li>
                                </div>
                            </form>
                        </td>
                        <td>
                            <div class="d-flex mt-2 ms-2">
                                <div class="d-inline-block position-relative text-dark">
                                    <img src="/static/images/2k-bronze-badge-count.webp" alt="" width="30">
                                    <p class="position-absolute text-center badge-count">{{$players.BronzeBadges}}</p>
                                </div>
                                <div class="d-inline-block position-relative float-left text-dark">
                                    <img src="/static/images/2k-silver-badge-count.webp" alt="" width="30">
                                    <p class="position-absolute text-center badge-count">{{$players.SilverBadges}}</p>
                                </div>
                                <div class="d-inline-block position-relative float-left text-dark">
                                    <img src="/static/images/2k-gold-badge-count.webp" alt="" width="30">
                                    <p class="position-absolute text-center badge-count">{{$players.GoldBadges}}</p>
                                </div>
                                <div class="d-inline-block position-relative float-left text-dark">
                                    <img src="/static/images/2k-hof-badge-count.webp" alt="" width="30">
                                    <p class="position-absolute text-center badge-count">{{$players.HOFBadges}}</p>
                                </div>
                                <div class="d-inline-block position-relative float-left text-dark">
                                    <img src="/static/images/2k-total-badge-count.webp" alt="" width="30">
                                    <p class="position-absolute text-center badge-count text-white">
                                        {{$players.TotalBadges}}</p>
                                </div>
                            </div>
                        </td>
                        <td><span style="font-size: 12px;" class="badge badge-pill 
                            {{if ge $players.StatsOverall 80}}
                                {{if ge $players.StatsOverall 85}}
                                    {{if ge $players.StatsOverall 90}}
                                        bkcolor
                                    {{else}}
                                        badgecolor1
                                    {{end}}
                                {{else}}
                                    badgecolor2
                                {{end}}
                            {{else}}
                            bg-light border text-dark
                            {{end}}
                        ">{{.StatsOverall}}</span></td>
                        <td>{{$players.StatsDefending}}</td>
                        <td>{{$players.StatsThreePointShot}}</td>
                        <td>{{$players.StatsFreeThrow}}</td>
                        <td>{{$players.StatsSpeed}}</td>
                        <td>{{$players.StatsAcceleration}}</td>
                        <td>{{$players.StatsStrength}}</td>
                        <td>{{$players.StatsVertical}}</td>
                        <td>{{$players.StatsDrivingDunk}}</td>
                        <td>{{$players.StatsDrawFoul}}</td>
                        <td>{{$players.StatsInteriorDefense}}</td>
                        <td>{{$players.StatsPerimeterDefense}}</td>
                        <td>{{$players.StatsSteal}}</td>
                        <td>{{$players.StatsBlock}}</td>
                        <td>{{$players.StatsOffensiveRebound}}</td>
                        <td>{{$players.StatsDefensiveRebound}}</td>
                        <td>
                            <span class="badge badge-pill text-dark border bg-light">{{$players.StatsTotalAttributes}}</span>
                        </td>
                    </tr>
                    {{end}}

                </tbody>
            </table>
        </div>
    </div>
</div>



{{end}}

{{define "js"}}
<script>
    // Search
    $(document).ready(function () {
        $("#myInput").on("keyup", function () {
            var value = $(this).val().toLowerCase();
            $("#nbaPlayersTable tr").filter(function () {
                $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
        });
    });

    // Get the button
    var mybutton = document.getElementById("scrollUpButton");

    // When the user scrolls down 20px from the top of the document, show the button
    window.onscroll = function () { scrollFunction() };

    function scrollFunction() {
        if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
            mybutton.style.display = "block";
        } else {
            mybutton.style.display = "none";
        }
    }

    // When the user clicks on the button, scroll to the top of the document
    function topFunction() {
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
    }

    function submitForm(teamID, fieldID, formID) {
        document.getElementById(fieldID).value = teamID;
        document.getElementById(formID).submit();
   }

</script>

{{end}}