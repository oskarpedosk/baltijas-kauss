{{template "base" .}}

{{define "content"}}

<title>Players | Baltijas Kauss</title>

<div class="container">
    <div class="row">
        <div id="players_table" class="col-md-9">
            <table class="table table-sm table-responsive table-borderless table-hover" style="border-bottom: 0.5px solid rgb(190, 190, 190);">
                <thead style="font-size: 14px; white-space: nowrap; text-align: center;">
                    <tr style="background-color: white;">
                        <th>#</th>
                        <th></th>
                        <th class="ps-2" style="text-align: start;">NAME</th>
                        <th title="Overall Rating" data-bs-toggle="tooltip" data-bs-placement="top">OVR</th>
                        <th title="Three Point Shot" data-bs-toggle="tooltip" data-bs-placement="top">3PT</th>
                        <th title="Driving Dunk" data-bs-toggle="tooltip" data-bs-placement="top">DUNK</th>
                        <th title="Athleticism" data-bs-toggle="tooltip" data-bs-placement="top">ATHL</th>
                        <th title="Perimeter Defense" data-bs-toggle="tooltip" data-bs-placement="top">PER D</th>
                        <th title="Interior Defense" data-bs-toggle="tooltip" data-bs-placement="top">INT D</th>
                        <th title="Rebounding" data-bs-toggle="tooltip" data-bs-placement="top">REB</th>
                        <th title="Badges" data-bs-toggle="tooltip" data-bs-placement="top">BADGES</th>
                        <th title="Total Attributes" data-bs-toggle="tooltip" data-bs-placement="top">TOTAL</th>
                    </tr>
                </thead>
                <tbody style="white-space: nowrap; text-align: center; vertical-align: middle;">
                    {{$ranking := index .Data "ranking"}}
                    {{range $index, $player := index .Data.players}}
                    <tr class="searchable" style="border-top: 0.5px solid rgb(190, 190, 190);">
                        <td class="p-0">{{index $ranking $index}}</td>
                        <td class="p-0 py-1">
                            <!-- <a href="/players/{{$player.Player.PlayerID}}"><img src="{{$player.Player.ImgURL}}"
                            alt="" class="header-image rounded-circle inline-block border"></a> -->
                        </td>
                        <td class="p-0 ps-2">
                            <div class="d-flex player-card">
                                <div class="p-0 inline-block">
                                    <p class="m-0"><a class="player-link" href="/players/{{$player.Player.PlayerID}}">{{$player.Player.FirstName}} {{$player.Player.LastName}}</a></p>
                                    <div class="my-0">
                                        <p class="text-muted my-0 pointer" style="font-size: 12px;" data-bs-toggle="dropdown" aria-expanded="false">
                                            {{$player.Player.PrimaryPosition}}{{if $player.Player.SecondaryPosition}}/{{$player.Player.SecondaryPosition}}{{end}}
                                            | {{$player.Player.Height}}cm | <span id="player_{{$player.Player.PlayerID}}_abbreviation">{{$player.Team.Abbreviation}}</span>
                                        </p>
                                        <div class="dropdown-menu">
                                            {{range $team := $.Data.teams}}
                                                <li class="dropdown-item" onclick="changeTeam('{{$player.Player.PlayerID}}', '{{$player.Player.FirstName}}', '{{$player.Player.LastName}}', '{{$team.TeamID}}', '{{$team.Abbreviation}}', '{{$.CSRFToken}}')">
                                                    {{$team.Abbreviation}} {{$team.Name}}
                                                </li>
                                            {{end}}
                                            <hr class="dropdown-divider">
                                            <li class="dropdown-item" onclick="changeTeam('{{$player.Player.PlayerID}}', '{{$player.Player.FirstName}}', '{{$player.Player.LastName}}', '{{$.Data.FA.TeamID}}', '{{$.Data.FA.Abbreviation}}', '{{$.CSRFToken}}')">
                                                {{$.Data.FA.Name}}
                                            </li>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </td>
                        <td><span class="overall-badge" overall-color="{{$player.Player.Overall}}">{{$player.Player.Overall}}</span></td>
                        <td>{{$player.Player.Attributes.ThreePointShot}}</td>
                        <td>{{$player.Player.Attributes.DrivingDunk}}</td>
                        <td>{{$player.Player.Attributes.Athleticism}}</td>
                        <td>{{$player.Player.Attributes.PerimeterDefense}}</td>
                        <td>{{$player.Player.Attributes.InteriorDefense}}</td>
                        <td>{{$player.Player.Attributes.Rebounding}}</td>
                        <td>
                            <span class="playerbadge badge badge-pill p-1 bronze">{{$player.Player.BronzeBadges}}</span>
                            <span class="playerbadge badge badge-pill p-1 silver">{{$player.Player.SilverBadges}}</span>
                            <span class="playerbadge badge badge-pill p-1 gold">{{$player.Player.GoldBadges}}</span>
                            <span class="playerbadge badge badge-pill p-1 hof">{{$player.Player.HOFBadges}}</span>
                            <span class="playerbadge badge badge-pill p-1 total">{{$player.Player.TotalBadges}}</span>
                        </td>
                        <td>
                            <span class="playerbadge badge badge-pill p-1 text-dark bg-light border" style="background-color: rgb(237, 237, 237); width: 50px;">{{$player.Player.Attributes.TotalAttributes}}</span>
                        </td>
                    </tr>
                    {{end}}

                </tbody>
            </table>
            <div class="row">
                {{ template "pagination" .}}
            </div>
        </div>
        
        <div class="col-md-3">
            <div id="filterForm">
            <div class="row">
                <p class="fw-bold mt-1" style="font-size: 14px;">FILTER</p>
            </div>
                <!-- <div>
                    <input id="name" type="text" placeholder="Name" class="form-control" value="">                  
                </div> -->

                <div id="positionsFilter">
                    <div>
                        <input class="form-check-input" type="checkbox" name="p1" checked>
                        <p>PG</p>
                    </div>
                    <div>
                        <input class="form-check-input" type="checkbox" name="p2" checked>
                        <p>SG</p>
                    </div>
                    <div>
                        <input class="form-check-input" type="checkbox" name="p3" checked>
                        <p>SF</p>
                    </div>
                    <div>
                        <input class="form-check-input" type="checkbox" name="p4" checked>
                        <p>PF</p>
                    </div>
                    <div>
                        <input class="form-check-input" type="checkbox" name="p5" checked>
                        <p>C</p>
                    </div>
                </div>
                <div>
                    <select class="form-select">
                        <option value="0">All Teams</option>
                        {{range $team := $.Data.teams}}
                            <option value="{{$team.TeamID}}">{{$team.Name}}</option>
                        {{end}}
                        <option value="1">Free Agency</option>
                      </select>                      
                </div>
                <hr>
                <div class="filter-attribute">
                    <p>Height</p>
                    <input name="hl" type="text" class="form-control" placeholder="150cm">
                    <input name="hh" type="text" class="form-control" placeholder="250cm">
                </div>
                <div class="filter-attribute">
                    <p>Weight</p>
                    <input name="wl" type="text" class="form-control" placeholder="50kg">
                    <input name="wh" type="text" class="form-control" placeholder="150kg">
                </div>
                <hr>
                <div class="filter-attribute">
                    <p>Overall</p>
                    <input name="ovrl" type="text" class="form-control" placeholder="1">
                    <input name="ovrh" type="text" class="form-control" placeholder="99">
                </div>
                <div class="filter-attribute">
                    <p>Three Point Shot</p>
                    <input name="3ptl" type="text" class="form-control" placeholder="1">
                    <input name="3pth" type="text" class="form-control" placeholder="99">
                </div>
                <div class="filter-attribute">
                    <p>Driving Dunk</p>
                    <input name="ddunkl" type="text" class="form-control" placeholder="1">
                    <input name="ddunkh" type="text" class="form-control" placeholder="99">
                </div>
                <div class="filter-attribute">
                    <p>Athleticism</p>
                    <input name="athl" type="text" class="form-control" placeholder="1">
                    <input name="athh" type="text" class="form-control" placeholder="99">
                </div>
                <div class="filter-attribute">
                    <p>Perimeter Defense</p>
                    <input name="perdl" type="text" class="form-control" placeholder="1">
                    <input name="perdh" type="text" class="form-control" placeholder="99">
                </div>
                <div class="filter-attribute">
                    <p>Interior Defense</p>
                    <input name="intdl" type="text" class="form-control" placeholder="1">
                    <input name="intdh" type="text" class="form-control" placeholder="99">
                </div>
                <div class="filter-attribute">
                    <p>Rebounding</p>
                    <input name="rebl" type="text" class="form-control" placeholder="1">
                    <input name="rebh" type="text" class="form-control" placeholder="99">
                </div>

                <button class="btn btn-outline-dark" style="width: 100%;">Reset</button>
                <button class="btn bkcolor btn-outline-light" style="width: 100%;" onclick="filterPlayers()">Submit</button>

            </div>
        </div>
    </div>
</div>



{{end}}

{{define "js"}}

<script src="/static/js/pagination.js"></script>

<script>
    $(document).ready(function(){
    let colorRange = {
        '91-99' :'overall1',
        '86-90' :'overall2',
        '81-85' :'overall3',
        '1-80'  :'overall4',
        '0-0'   :'overall5',
    };
    
    function between(value, min, max) {
        return value >= min && value <= max;
    }
    
    let color;
    let first; 
    let second;
    let overall;
    
    $('.overall-badge').each(function(index){
        
        overall = $(this);
        color = parseInt($(this).attr('overall-color'),10);
        
        $.each(colorRange, function(name, value){
            
            first = parseInt(name.split('-')[0],10);
            second = parseInt(name.split('-')[1],10);
            
            if( between(color, first, second) ){
                overall.addClass(value);
            }
        
        });
        
    });
    });
</script>

<script>
    function changeTeam(playerID, firstName, lastName, teamID, abbreviation, csrftoken) {
        $.ajax({
        type: "POST",
        url: "/players",
        data : {
            csrf_token: csrftoken,
            action: "change_team",
            player_id: playerID,
            team_id: teamID,
        },
        success: function(response) {
            const team = document.getElementById('player_' + playerID + '_abbreviation');
            team.textContent = abbreviation;
            notie.alert({ type: 1, text: firstName + ' ' + lastName + ' added to ' + abbreviation});
        },
        error: function(jqXHR, textStatus, errorThrown) {
            notie.alert({ type: 3, text: 'Error adding player: ' + errorThrown});
        }
        });
    }
 </script>

<script>
    function filterPlayers() {
        let URLWithoutQueries = window.location.origin + window.location.pathname
        let url = new URL(URLWithoutQueries)
        let inputs = document.querySelectorAll('#filterForm input')
        inputs.forEach(input => {
            if ((!input.checked) && input.type === 'checkbox') {
                url.searchParams.set(input.name, 0)
            } else if (input.value && input.type !== 'checkbox') {
                url.searchParams.set(input.name, input.value)
            }
        })
        let teams = document.querySelector('select')
        if (teams.value !== '0') {
            url.searchParams.set("team", teams.value)
        }
        window.location.href = url.toString()
    }
</script>

{{end}}