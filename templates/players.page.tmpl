{{template "base" .}}

{{define "content"}}

<title>Players | Baltijas Kauss</title>

<div class="container">
    <div class="row">
        <div class="col-md-9">
            {{ template "pagination" .}}
        </div>
    </div>
    <div class="row">
        <div id="players_table" class="col-md-9">
            <table class="table table-sm table-responsive table-borderless table-hover" style="border-bottom: 0.5px solid rgb(190, 190, 190);">
                <thead style="font-size: 14px; white-space: nowrap; text-align: center;">
                    <tr style="background-color: white; border-bottom: 1px solid rgb(190, 190, 190);">
                        <th>#</th>
                        <th></th>
                        <th class="ps-2" style="text-align: start;">NAME</th>
                        <th title="Overall Rating" data-bs-toggle="tooltip" data-bs-placement="top">OVR</th>
                        <th title="Three Point Shot" data-bs-toggle="tooltip" data-bs-placement="top">3PT</th>
                        <th title="Driving Dunk" data-bs-toggle="tooltip" data-bs-placement="top">DUNK</th>
                        <th title="Athleticism" data-bs-toggle="tooltip" data-bs-placement="top">ATHL</th>
                        <th title="Perimeter Defense" data-bs-toggle="tooltip" data-bs-placement="top">PER D</th>
                        <th title="Interior Defense" data-bs-toggle="tooltip" data-bs-placement="top">INT D</th>
                        <th title="Rebounding" data-bs-toggle="tooltip" data-bs-placement="top">REB</th>
                        <th title="Badges" data-bs-toggle="tooltip" data-bs-placement="top">BADGES</th>
                        <th title="Total Attributes" data-bs-toggle="tooltip" data-bs-placement="top">TOTAL</th>
                    </tr>
                </thead>
                <tbody style="white-space: nowrap; text-align: center; vertical-align: middle;">
                    {{$ranking := index .Data "ranking"}}
                    {{range $index, $player := index .Data.players}}
                    <tr class="searchable" style="border-top: 0.5px solid rgb(190, 190, 190);">
                        <td class="p-0">{{index $ranking $index}}</td>
                        <td class="p-0 py-1">
                            <a href="/players/{{$player.Player.PlayerID}}"><img src="{{$player.Player.ImgURL}}"
                            alt="" class="header-image rounded-circle inline-block border"></a>
                        </td>
                        <td class="p-0 ps-2">
                            <div class="d-flex player-card">
                                <div class="p-0 inline-block">
                                    <p class="m-0"><a class="player-link" href="/players/{{$player.Player.PlayerID}}">{{$player.Player.FirstName}} {{$player.Player.LastName}}</a></p>
                                    <div class="my-0">
                                        <p class="text-muted my-0 pointer" style="font-size: 12px;" data-bs-toggle="dropdown" aria-expanded="false">
                                            {{$player.Player.PrimaryPosition}}{{if $player.Player.SecondaryPosition}}/{{$player.Player.SecondaryPosition}}{{end}}
                                            | {{$player.Player.Height}}cm | <span id="player_{{$player.Player.PlayerID}}_abbreviation">{{$player.Team.Abbreviation}}</span>
                                        </p>
                                        <div class="dropdown-menu">
                                            {{range $team := $.Data.teams}}
                                                <li class="dropdown-item" onclick="changeTeam('{{$player.Player.PlayerID}}', '{{$player.Player.FirstName}}', '{{$player.Player.LastName}}', '{{$team.TeamID}}', '{{$team.Abbreviation}}', '{{$.CSRFToken}}')">
                                                    {{$team.Abbreviation}} {{$team.Name}}
                                                </li>
                                            {{end}}
                                            <hr class="dropdown-divider">
                                            <li class="dropdown-item" onclick="changeTeam('{{$player.Player.PlayerID}}', '{{$player.Player.FirstName}}', '{{$player.Player.LastName}}', '{{$.Data.FA.TeamID}}', '{{$.Data.FA.Abbreviation}}', '{{$.CSRFToken}}')">
                                                {{$.Data.FA.Name}}
                                            </li>
                                        </div>
                                    </div>

                                </div>
                            </div>
                        </td>
                        <td><span class="overall-badge" overall-color="{{$player.Player.Overall}}">{{$player.Player.Overall}}</span></td>
                        <td>{{$player.Player.Attributes.ThreePointShot}}</td>
                        <td>{{$player.Player.Attributes.DrivingDunk}}</td>
                        <td>{{$player.Player.Attributes.Athleticism}}</td>
                        <td>{{$player.Player.Attributes.PerimeterDefense}}</td>
                        <td>{{$player.Player.Attributes.InteriorDefense}}</td>
                        <td>{{$player.Player.Attributes.Rebounding}}</td>
                        <td>
                            <span class="playerbadge badge badge-pill p-1 bronze">{{$player.Player.BronzeBadges}}</span>
                            <span class="playerbadge badge badge-pill p-1 silver">{{$player.Player.SilverBadges}}</span>
                            <span class="playerbadge badge badge-pill p-1 gold">{{$player.Player.GoldBadges}}</span>
                            <span class="playerbadge badge badge-pill p-1 hof">{{$player.Player.HOFBadges}}</span>
                            <span class="playerbadge badge badge-pill p-1 total">{{$player.Player.TotalBadges}}</span>
                        </td>
                        <td>
                            <span class="playerbadge badge badge-pill p-1 text-dark bg-light border" style="background-color: rgb(237, 237, 237); width: 50px;">{{$player.Player.Attributes.TotalAttributes}}</span>
                        </td>
                    </tr>
                    {{end}}

                </tbody>
            </table>
            <div class="row">
                {{ template "pagination" .}}
            </div>
        </div>
        
        <div class="col-md-3">
            <form id="filter" action="/players" method="GET">
            <div class="row">
                <p class="fw-bold mt-1" style="font-size: 14px;">SEARCH</p>
            </div>
                <div>
                    <input id="name" type="text" placeholder="Name" class="form-control" value="">                  
                </div>

                <div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="position_pg">
                        <p>PG</p>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="position_sg">
                        <p>SG</p>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="position_sf">
                        <p>SF</p>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="position_pf">
                        <p>PF</p>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="checkbox" name="position_c">
                        <p>C</p>
                    </div>
                </div>

                <button class="btn bkcolor btn-outline-light" type="submit" style="width: 100%;">Submit</button>

                <div class="filter-attribute">
                    <p>Height</p>
                    <input name="hl" type="text" class="form-control" value="{{with .Form.Values.Get `hl`}}{{end}}">
                    <input name="hh" type="text" class="form-control" value="{{with .Form.Values.Get `hh`}}{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>Weight</p>
                    <input name="weight_min" type="text" class="form-control" value="{{with .Form.Values.Get `weight_min`}}{{end}}">
                    <input name="weight_max" type="text" class="form-control" value="{{with .Form.Values.Get `weight_max`}}{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>Overall</p>
                    <input name="ovrl" type="text" class="form-control" value="{{with .Form.Values.Get `ovrl`}}{{end}}">
                    <input name="ovrh" type="text" class="form-control" value="{{with .Form.Values.Get `ovrh`}}{{end}}">
                </div>

                <!-- <div>
                    <select class="form-select">
                        <option selected>Team</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                      </select>                      
                </div>

                <div class="filter-attribute">
                    <p>Three Point Shot</p>
                    <input name="3pt_min" type="text" class="form-control" value="{{with .Form.Values.Get `3pt_min`}}{{else}}1{{end}}">
                    <input name="3pt_max" type="text" class="form-control" value="{{with .Form.Values.Get `3pt_max`}}{{else}}99{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>Driving Dunk</p>
                    <input name="driving_dunk_min" type="text" class="form-control" value="{{with .Form.Values.Get `driving_dunk_min`}}{{else}}1{{end}}">
                    <input name="driving_dunk_max" type="text" class="form-control" value="{{with .Form.Values.Get `driving_dunk_max`}}{{else}}99{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>Athleticism</p>
                    <input name="athleticism_min" type="text" class="form-control" value="{{with .Form.Values.Get `athleticism_min`}}{{else}}1{{end}}">
                    <input name="athleticism_max" type="text" class="form-control" value="{{with .Form.Values.Get `athleticism_max`}}{{else}}99{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>Perimeter Defense</p>
                    <input name="perimeter_defense_min" type="text" class="form-control" value="{{with .Form.Values.Get `perimeter_defense_min`}}{{else}}1{{end}}">
                    <input name="perimeter_defense_max" type="text" class="form-control" value="{{with .Form.Values.Get `perimeter_defense_max`}}{{else}}99{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>Interior Defense</p>
                    <input name="interior_defense_min" type="text" class="form-control" value="{{with .Form.Values.Get `interior_defense_min`}}{{else}}1{{end}}">
                    <input name="interior_defense_max" type="text" class="form-control" value="{{with .Form.Values.Get `interior_defense_max`}}{{else}}99{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>Rebounding</p>
                    <input name="rebounding_min" type="text" class="form-control" value="{{with .Form.Values.Get `rebounding_min`}}{{else}}1{{end}}">
                    <input name="rebounding_max" type="text" class="form-control" value="{{with .Form.Values.Get `rebounding_max`}}{{else}}99{{end}}">
                </div>

                <div>
                    <select class="form-select">
                        <option selected>NBA Team</option>
                        <option value="1">One</option>
                        <option value="2">Two</option>
                        <option value="3">Three</option>
                      </select>                      
                </div>

                <div class="filter-attribute">
                    <p>Bronze Badges</p>
                    <input name="bronze_badges_min" type="text" class="form-control" value="{{with .Form.Values.Get `bronze_badges_min`}}{{else}}0{{end}}">
                    <input name="bronze_badges_max" type="text" class="form-control" value="{{with .Form.Values.Get `bronze_badges_max`}}{{else}}60{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>Silver Badges</p>
                    <input name="silver_badges_min" type="text" class="form-control" value="{{with .Form.Values.Get `silver_badges_min`}}{{else}}0{{end}}">
                    <input name="silver_badges_max" type="text" class="form-control" value="{{with .Form.Values.Get `silver_badges_max`}}{{else}}60{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>Gold Badges</p>
                    <input name="gold_badges_min" type="text" class="form-control" value="{{with .Form.Values.Get `gold_badges_min`}}{{else}}0{{end}}">
                    <input name="gold_badges_max" type="text" class="form-control" value="{{with .Form.Values.Get `gold_badges_max`}}{{else}}60{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>HOF Badges</p>
                    <input name="hof_badges_min" type="text" class="form-control" value="{{with .Form.Values.Get `hof_badges_min`}}{{else}}0{{end}}">
                    <input name="hof_badges_max" type="text" class="form-control" value="{{with .Form.Values.Get `hof_badges_max`}}{{else}}60{{end}}">
                </div>
                <div class="filter-attribute">
                    <p>Total Badges</p>
                    <input name="total_badges_min" type="text" class="form-control" value="{{with .Form.Values.Get `total_badges_min`}}{{else}}0{{end}}">
                    <input name="total_badges_max" type="text" class="form-control" value="{{with .Form.Values.Get `total_badges_max`}}{{else}}60{{end}}">
                </div> -->
            </form>
        </div>
    </div>
</div>



{{end}}

{{define "js"}}

<script>
    $(document).ready(function(){
    let colorRange = {
        '91-99' :'overall1',
        '86-90' :'overall2',
        '81-85' :'overall3',
        '1-80'  :'overall4',
        '0-0'   :'overall5',
    };
    
    function between(value, min, max) {
        return value >= min && value <= max;
    }
    
    let color;
    let first; 
    let second;
    let overall;
    
    $('.overall-badge').each(function(index){
        
        overall = $(this);
        color = parseInt($(this).attr('overall-color'),10);
        
        $.each(colorRange, function(name, value){
            
            first = parseInt(name.split('-')[0],10);
            second = parseInt(name.split('-')[1],10);
            
            if( between(color, first, second) ){
                overall.addClass(value);
            }
        
        });
        
    });
    });
</script>

<script>
    function changeTeam(playerID, firstName, lastName, teamID, abbreviation, csrftoken) {
        $.ajax({
        type: "POST",
        url: "/players",
        data : {
            csrf_token: csrftoken,
            action: "change_team",
            player_id: playerID,
            team_id: teamID,
        },
        success: function(response) {
            const team = document.getElementById('player_' + playerID + '_abbreviation');
            team.textContent = abbreviation;
            notie.alert({ type: 1, text: firstName + ' ' + lastName + ' added to ' + abbreviation});
        },
        error: function(jqXHR, textStatus, errorThrown) {
            notie.alert({ type: 3, text: 'Error adding player: ' + errorThrown});
        }
        });
    }
 </script>

<script>
    $(document).ready(function(){
        $("form").submit(function(){
            $("input").each(function(index, obj){
                if($(obj).val() == "") {
                    $(obj).remove();
                }
            });
        });
    });
</script>

{{end}}